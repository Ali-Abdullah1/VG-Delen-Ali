<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>Shop</title>
</head>

<body class="body">
    <div id="navbar-wrapper">
        <nav class="row navbar navbar-expand-lg bg-transparent">

            <!--Shop logo-->
            <div class="container-fluid">
                <div class="d-flex align-item-center">
                    <a class="navbar-brand fs-1 ps-3">Shop</a>
                </div>

                <!--Search bar-->

                <div class="collapse navbar-collapse">
                    <form class="d-flex" role="search">
                        <input class="form-control me-2" type="search" placeholder="Sök på en produkt" aria-label="Search">
                        <button class="btn btn-outline-dark" type="submit">Sök</button>
                    </form>
                </div>
                <div class="d-flex">

                    <div class="collapse navbar-collapse headboard">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li><a href="#" class="nav-link a" data-page="home">Hem</a></li>
                            <li><a href="#" class="nav-link b" data-page="product">Produkter</a></li>
                            <li><a href="#" class="nav-link c" data-page="orderform">Beställningar</a></li>
                            <li><a href="#" class="nav-link d" data-page="contactform">Kontakt</a></li>
                        </ul>
                    </div>

                    <button class="navbar-toggler" type="button" onclick="displayMeny()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                             class="bi bi-list" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" />
                        </svg>
                    </button>

                    <!--cart Button-->
                    <button class="cartBTN" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample"
                        aria-controls="offcanvasExample">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                            class="bi bi-cart4" viewBox="0 0 16 16">
                            <path
                                d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5M3.14 5l.5 2H5V5zM6 5v2h2V5zm3 0v2h2V5zm3 0v2h1.36l.5-2zm1.11 3H12v2h.61zM11 8H9v2h2zM8 8H6v2h2zM5 8H3.89l.5 2H5zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0m9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0" />
                        </svg>
                    </button>
                </div>

            </div> <!--Container Fluid closes-->
        </nav>
        <!--pop up menu list in small screen-->
        <div class="collapse navbar-collapse bg-white" id="navbarMenyBtn">
            <div>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="searchBTNSmall btn-outline-dark" type="submit">Search</button>
                </form>
            </div>
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="#" data-page="home">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-page="product">Produkter</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-page="contactform">Kontakta Oss</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-page="orderform">Beställningar</a>
                </li>
            </ul>
        </div>
            <div class="row text-centerHerr " id="wrapper-gender">
                <ul class="list-inline">
                    <li class="btn list-inline-item" data-page="electronics">Elektronik</li>
                    <li class="btn list-inline-item" data-page="jewelery">Smycken</li>
                    <li class="btn list-inline-item" data-page="mensclothing">Herrkläder</li>
                    <li class="btn list-inline-item" data-page="womensclothing">Damkläder</li>
                </ul>
            </div>
    </div>



    <!--cart tab: pop up-->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasExampleLabel">Cart</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div id="produkten">
                
                Some products here...
            </div>
            <div id="total-price"></div>
            <button id="clear-cart-btn" class="btn btn-danger mt-3">Töm varukorg</button>
        </div>
    </div>

    <div id="content">
        <!-- Dynamisk kontent laddas här -->
    </div>

    <!-- Footer -->
    <footer class="row">

    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="script.js"></script>
    <script>
        let status = true;
        function displayMeny(){
            const collapsibleNavBar = document.getElementById('navbarMenyBtn');
            if (status){
                collapsibleNavBar.style.display = 'block';
                status = false;
            } else {
                collapsibleNavBar.style.display = 'none';
                status = true;
            }
        }

        function closeCollapsedMenu() {
            const collapsibleNavBar = document.getElementById('navbarMenyBtn');
            if (window.innerWidth > 768) {
                collapsibleNavBar.style.display = 'none';
                status = true;
            }
        }
        closeCollapsedMenu();
        window.addEventListener('resize', closeCollapsedMenu);




        $(document).ready(function () {

            function loadContent(page) {
                $.ajax({
                    url: page + '.html',
                    dataType: 'html',
                    success: function (response) {
                        $('#content').html(response);
                    },
                    error: function (xhr, status, error) {
                        console.error('Error loading page: ' + page, status, error);
                    }
                });
            }

            loadContent('home');

            $('.nav-link').click(function (e) {
                e.preventDefault();

                let page = $(this).data('page');
                loadContent(page);
            });

            $('.list-inline-item').click(function (e) {
                e.preventDefault();

                let page = $(this).data('page');
                loadContent(page);
            });
        });

        function sendData(product) {
        let existingProducts = [];
        
          // Hämta befintliga produkter från localStorage om det finns några
        if (localStorage.getItem("products")) {
            existingProducts = JSON.parse(localStorage.getItem("products"));
        }

        const existingProduct = existingProducts.find(item => item.id === product.id);

        if (existingProduct) {
            existingProduct.quantity += 1;
        } else {
             // Om produkten inte finns i varukorgen, lägg till den med antalet 1
            product.quantity = 1;
            existingProducts.push(product);
        }

        // Spara den uppdaterade varukorgen till localStorage som JSON-sträng
        localStorage.setItem("products", JSON.stringify(existingProducts));

        displayProductInfo();
    }




    document.getElementById('clear-cart-btn').addEventListener('click', function() {
   
    localStorage.removeItem('products');
    
    displayProductInfo();
});

            
            function displayProductInfo() {
                // Hämta produkter från localStorage eller använd en tom array om det inte finns några produkter
                const products = JSON.parse(localStorage.getItem('products')) || [];
                const productInfo = document.getElementById('produkten');
                const totalPriceElement = document.getElementById('total-price');

                // Rensa innehållet i varukorg och totalpris
                productInfo.innerHTML = ''; 
                totalPriceElement.innerHTML = ''; 

                // Om varukorgen är tom, visa meddelande och avsluta funktionen
                if (products.length === 0) {
                    productInfo.textContent = 'Din varukorg är tom.';
                    return;
                }

                let totalPrice = 0;
                // Loopa igenom varje produkt i varukorgen och skapa ett gränssnitt för varje produkt
                products.forEach(product => {
                    const productContainer = document.createElement('div');
                    productContainer.classList.add('product-container');

                    // Skapa element för produktinfo (titel, bild, pris) och lägg till i container
                    const productInfoElement = document.createElement('div');
                    productInfoElement.innerHTML = `
                        <h3>${product.title}</h3>
                        <img src="${product.image}" alt="${product.title}" class="product-img">
                        <p>Pris: ${product.price} kr</p>
                    `;
                    productContainer.appendChild(productInfoElement);
                    // Skapa en input för kvantitet och lägg till i container
                    const quantityElement = document.createElement('input');
                    quantityElement.type = 'number';
                    quantityElement.value = product.quantity;
                    quantityElement.min = 1;
                    quantityElement.classList.add('quantity-input');
                    productContainer.appendChild(quantityElement);
                     // Skapa en knapp för att ta bort produkten och lägg till i container
                    const removeButton = document.createElement('button');
                    removeButton.textContent = 'Ta bort';
                    removeButton.classList.add('btn', 'btn-danger');
                    productContainer.appendChild(removeButton);

                    productInfo.appendChild(productContainer);

                    // Totalpris
                    const productTotalPrice = product.quantity * product.price;
                    totalPrice += productTotalPrice;

                    removeButton.addEventListener('click', function() {
                        removeProductFromCart(product);
                    });

               
                    quantityElement.addEventListener('change', function() {
                        updateProductQuantity(product, parseInt(quantityElement.value));
                    });
                });

                totalPriceElement.textContent = `Total Pris: ${Math.round(totalPrice)} kr`;
            }

            function removeProductFromCart(product) {
                // Hämta varukorgen från localStorage eller använd en tom array om det inte finns några produkter sparade
                let cart = JSON.parse(localStorage.getItem('products')) || [];
                 // Hitta index för den produkten som ska tas bort i varukorgen
                const productIndex = cart.findIndex(item => item.id === product.id);
                // Om produkten finns i varukorgen (index är inte -1)
                if (productIndex !== -1) {
                     // Ta bort produkten från varukorgen genom att använda splice() för att ta bort ett element på det specifika indexet
                    cart.splice(productIndex, 1);
                    // Uppdatera varukorgen i localStorage
                    localStorage.setItem('products', JSON.stringify(cart));
                    // Uppdatera gränssnittet för varukorgen på webbsidan
                    displayProductInfo(); 
                } else {
                    console.error('Product not found');
                }
            }

          
            function updateProductQuantity(product, newQuantity) {
                // Kontrollera om den nya kvantiteten är ett numeriskt värde och större än 0
                if (!isNaN(newQuantity) && newQuantity > 0) {
                    let cart = JSON.parse(localStorage.getItem('products')) || [];
                    // Hittar produkten baserat på produktens ID
                    const existingProduct = cart.find(item => item.id === product.id);

                    if (existingProduct) {
                        // Uppdatera kvantiteten för produkten 
                        existingProduct.quantity = newQuantity;
                        localStorage.setItem('products', JSON.stringify(cart));
                        displayProductInfo();
                    } else {
                        console.error('Product not found');
                    }
                } else {
                    console.error('Invalid quantity');
                    displayProductInfo(); 
                }
            }

            
            displayProductInfo();

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

</body>

</html>